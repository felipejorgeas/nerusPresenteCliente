<div class="content-response"></div>

<script>

  $(function() {

    var lista = sessionStorage.getItem("listaSelecionada");
    lista = JSON.parse(lista);

    var produtos = [];

    /**
     * Verifica se veio apenas um produtos ou varios.
     * Isto influencia na estrutura do array de produtos
     *
     * Ex.:
     *      se vier apenas um produto o array retornado sera:
     *      lista_produtos = array("codigo_produto", "grade", ...);
     *
     *      se vier varios produtos o array retornado sera:
     *      lista_produtos = array(0 => array("codigo_produto", "grade", ...),
     *                             1 => array("codigo_produto", "grade", ...));
     *
     * O tratamento abaixo garante que iremos manipular sempre
     * um array multi-dimensional no each().
     */
    if (lista.lista_produtos.produto.hasOwnProperty("0")) {
      produtos = lista.lista_produtos.produto;
    } else {
      produtos.push(lista.lista_produtos.produto);
    }

    var page = $("#content").find(".page.activePage:last");
    var pageId = "#" + page.attr("id");
    var contentResponse = page.find(".content-response");

    $.each(produtos, function(i, produto) {
      // tratamento dos dados retornados
      var produtoCodigo = produto.codigo_produto;
      var produtoNome = produto.nome_produto;

      contentResponse.append("<p class='produto' id='" + produtoCodigo +"'>" + produtoCodigo + " - " + produtoNome + "</p>");
    });

    hideMask();
  });
</script>